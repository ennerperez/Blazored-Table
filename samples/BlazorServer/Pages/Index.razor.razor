@page "/"
@using System.Collections.ObjectModel
@using System.IO
@using BlazorServer.Models
@using Microsoft.AspNetCore.Mvc
@inject Interfaces.IEmployeeRepository _employeeService

<h1>Blazored Table Sample</h1>

<hr class="mb-5" />

<p>
    This is an example of using Blazored Table in its most simplistic form.
</p>

<button class="btn btn-success" onclick="GetDataAsync()">GetData</button>

@* <BlazoredTable Id="Example1" AjaxUrl="/api/employees" /> *@


@code {

    [Parameter]
    public ObservableCollection<object> Employees { get; set; }

    protected override async Task OnInitializedAsync()
    {
        /*var dir = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "data");
        var json = await File.ReadAllTextAsync($"{dir}/employees.json");
        var data = Newtonsoft.Json.JsonConvert.DeserializeObject<IEnumerable<Employee>>(json);
        if (data != null) Employees = new ObservableCollection<object>(data);*/
        EmployeeService = _employeeService;
        await base.OnInitializedAsync();
    }

    private static Interfaces.IEmployeeRepository EmployeeService;

    [JSInvokable]
    public static async Task<AjaxResult> GetDataAsync()
    {
        
        var model = new AjaxViewModel()
        {
            Start = 10, 
            Length = 100
        };
        var data = await EmployeeService.GetDataAsync(model, e => new {e.Id, e.Office, e.Position, e.Salary, e.FirstName, e.LastName});
        return data;
    }

}